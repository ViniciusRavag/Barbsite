<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barber Shop Mobile</title>
<!-- Tailwind CSS CDN para um estilo moderno -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Google Fonts - Poppins e Inter -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<!-- Font Awesome para ícones -->
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
--primary-dark: #1a1a1a;
--secondary-dark: #2a2a2a;
--accent-gold: #d4af37;
--light-gold: #f4e7c1;
--cream: #f5f1e8;
--warm-gray: #6b6b6b;
--light-gray: #e5e1d8;
}
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
min-height: 100vh;
color: #f5f1e8;
}
.heading-font {
font-family: 'Poppins', sans-serif;
}
.animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
@keyframes fadeIn {
from { opacity: 0; transform: translateY(-10px); }
to { opacity: 1; transform: translateY(0); }
}
.status-badge {
display: inline-block;
padding: 0.25rem 0.75rem;
border-radius: 9999px;
font-size: 0.75rem;
font-weight: 600;
text-transform: capitalize;
}
.status-pendente {
background: linear-gradient(135deg, #fbbf24, #f59e0b);
color: #1a1a1a;
}
.status-confirmado {
background: linear-gradient(135deg, #10b981, #059669);
color: #1a1a1a;
}
.status-cancelado {
background: linear-gradient(135deg, #ef4444, #dc2626);
color: #f5f1e8;
}
.status-realizado {
background: linear-gradient(135deg, #3b82f6, #1d4ed8);
color: #f5f1e8;
}
.service-card-selected, .time-button-selected {
border-color: var(--accent-gold);
background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.05));
box-shadow: 0 0 0 2px var(--accent-gold), 0 8px 25px rgba(212, 175, 55, 0.3);
}
.glass-card {
background: rgba(42, 42, 42, 0.8);
backdrop-filter: blur(10px);
border: 1px solid rgba(212, 175, 55, 0.2);
}
.gold-gradient {
background: linear-gradient(135deg, #d4af37, #f4e7c1);
color: #1a1a1a;
}
.gold-gradient:hover {
background: linear-gradient(135deg, #f4e7c1, #d4af37);
}
.dark-card {
background: rgba(26, 26, 26, 0.95);
border: 1px solid rgba(212, 175, 55, 0.3);
}
.input-dark {
background: rgba(42, 42, 42, 0.8);
border: 2px solid rgba(212, 175, 55, 0.3);
color: #f5f1e8;
}
.input-dark:focus {
border-color: var(--accent-gold);
box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
}
.input-dark::placeholder {
color: #6b6b6b;
}
.btn-primary {
background: linear-gradient(135deg, #d4af37, #f4e7c1);
color: #1a1a1a;
font-weight: 700;
transition: all 0.3s ease;
}
.btn-primary:hover:not(:disabled) {
background: linear-gradient(135deg, #f4e7c1, #d4af37);
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}
.btn-secondary {
background: rgba(107, 107, 107, 0.8);
color: #f5f1e8;
border: 1px solid rgba(212, 175, 55, 0.3);
}
.btn-secondary:hover {
background: rgba(212, 175, 55, 0.2);
border-color: var(--accent-gold);
}
.btn-disabled {
background: rgba(107, 107, 107, 0.5);
color: rgba(245, 241, 232, 0.5);
cursor: not-allowed;
}
.service-card {
background: rgba(42, 42, 42, 0.6);
border: 2px solid rgba(212, 175, 55, 0.2);
transition: all 0.3s ease;
}
.service-card:hover {
background: rgba(42, 42, 42, 0.8);
border-color: rgba(212, 175, 55, 0.4);
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}
.time-button {
background: rgba(42, 42, 42, 0.6);
border: 2px solid rgba(212, 175, 55, 0.2);
color: #f5f1e8;
transition: all 0.3s ease;
}
.time-button:hover {
background: rgba(42, 42, 42, 0.8);
border-color: rgba(212, 175, 55, 0.4);
}
.date-button {
background: rgba(42, 42, 42, 0.6);
border: 2px solid rgba(212, 175, 55, 0.2);
color: #f5f1e8;
transition: all 0.3s ease;
}
.date-button:hover {
background: rgba(42, 42, 42, 0.8);
border-color: rgba(212, 175, 55, 0.4);
}
.modal-backdrop {
background: rgba(26, 26, 26, 0.9);
backdrop-filter: blur(5px);
}
</style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
<div class="max-w-2xl w-full glass-card rounded-2xl shadow-2xl p-6 sm:p-8 space-y-8">
<!-- Título principal -->
<div class="text-center">
<h1 class="text-4xl font-extrabold heading-font text-transparent bg-clip-text bg-gradient-to-r
from-yellow-400 to-yellow-600">Barber Shop</h1>
<p class="text-warm-gray mt-2 font-medium">Agende seu horário ou gerencie a
agenda.</p>
</div>
<!-- Modal de Notificação -->
<div id="modal" class="fixed inset-0 modal-backdrop hidden flex items-center justify-center
p-4 z-50">
<div class="dark-card rounded-2xl p-8 shadow-3xl max-w-sm w-full text-center
animate-fade-in">
<p id="modal-message" class="text-cream text-lg font-medium mb-5"></p>
<button id="close-modal-btn" class="btn-primary py-3 px-8 rounded-full transition
duration-300 transform hover:scale-105 font-bold">Fechar</button>
</div>
</div>
<!-- Modal para Adicionar Agendamento do Barbeiro -->
<div id="barber-add-modal" class="fixed inset-0 modal-backdrop hidden flex items-center
justify-center p-4 z-50">
<div class="dark-card rounded-2xl p-8 shadow-3xl max-w-lg w-full animate-fade-in">
<div class="flex justify-between items-center mb-5">
<h3 class="text-2xl font-bold heading-font text-cream">Adicionar Novo Agendamento</h3>
<button id="close-add-modal-btn" class="text-warm-gray hover:text-cream text-3xl font-light
transition duration-300">&times;</button>
</div>
<form id="barber-add-form" class="space-y-4">
<input type="text" id="barber-client-name" placeholder="Nome do Cliente" required
class="w-full p-3 input-dark rounded-xl focus:outline-none transition duration-200">
<input type="tel" id="barber-client-phone" placeholder="WhatsApp (ex: 5511999999999)"
required class="w-full p-3 input-dark rounded-xl focus:outline-none transition duration-200">
<select id="barber-service-select" required class="w-full p-3 input-dark rounded-xl
focus:outline-none transition duration-200">
<option value="" disabled selected>Selecione o Serviço</option>
<option value="Corte de Cabelo">Corte de Cabelo</option>
<option value="Barba">Barba</option>
<option value="Cabelo e Barba">Cabelo e Barba</option>
<option value="Pigmentação">Pigmentação</option>
</select>
<input type="date" id="barber-appointment-date" required class="w-full p-3 input-dark
rounded-xl focus:outline-none transition duration-200">
<input type="time" id="barber-appointment-time" required class="w-full p-3 input-dark
rounded-xl focus:outline-none transition duration-200">
<button type="submit" class="w-full btn-primary font-bold py-3 rounded-xl transition
duration-300 transform hover:scale-105 shadow-lg">Adicionar Agendamento</button>
</form>
</div>
</div>
<!-- View do Cliente -->
<div id="client-view">
<h2 class="text-2xl font-bold heading-font text-cream mb-6 text-center">Agendar um
Horário</h2>
<!-- Formulário de Agendamento em Etapas -->
<div id="appointment-stepper" class="space-y-4">
<!-- Etapa 1: Dados do Cliente -->
<div id="step-1" class="step">
<h3 class="text-xl font-bold heading-font text-cream mb-4">1. Seus Dados</h3>
<div class="space-y-4">
<div class="relative">
<i class="fas fa-user absolute left-4 top-1/2 -translate-y-1/2 text-yellow-500"></i>
<input type="text" id="client-name" placeholder="Seu Nome" required class="w-full p-3 pl-12
input-dark rounded-xl focus:outline-none transition duration-200">
</div>
<div class="relative">
<i class="fab fa-whatsapp absolute left-4 top-1/2 -translate-y-1/2 text-green-400"></i>
<input type="tel" id="client-phone" placeholder="WhatsApp (ex: 5511999999999)" required
class="w-full p-3 pl-12 input-dark rounded-xl focus:outline-none transition duration-200">
</div>
<button id="next-step-1-btn" class="w-full btn-primary font-bold py-3 rounded-xl transition
duration-300 transform hover:scale-105 shadow-lg">
Próximo <i class="fas fa-arrow-right ml-2"></i>
</button>
</div>
</div>
<!-- Etapa 2: Seleção do Serviço -->
<div id="step-2" class="step hidden animate-fade-in">
<h3 class="text-xl font-bold heading-font text-cream mb-4">2. Selecione o Serviço</h3>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4" id="service-options">
<!-- Cards de serviço serão injetados aqui -->
</div>
<button id="next-step-2-btn" disabled class="w-full btn-disabled font-bold py-3 rounded-xl
mt-6 shadow-lg">
Próximo <i class="fas fa-arrow-right ml-2"></i>
</button>
<button id="back-step-2-btn" class="w-full btn-secondary font-bold py-3 rounded-xl mt-2
transition duration-300 transform hover:scale-105">
<i class="fas fa-arrow-left mr-2"></i> Voltar
</button>
</div>
<!-- Etapa 3: Seleção de Data e Hora -->
<div id="step-3" class="step hidden animate-fade-in">
<h3 class="text-xl font-bold heading-font text-cream mb-4">3. Escolha a Data e Hora</h3>
<div class="space-y-4">
<!-- Botões de data (próximos 7 dias) -->
<div id="date-picker-container" class="grid grid-cols-2 sm:grid-cols-4 gap-2">
<!-- Botões de data serão injetados aqui -->
</div>
<!-- Botões de horário -->
<div id="time-picker-container" class="grid grid-cols-3 sm:grid-cols-4 gap-2">
<!-- Botões de horário serão injetados aqui -->
</div>
</div>
<button id="next-step-3-btn" disabled class="w-full btn-disabled font-bold py-3 rounded-xl
mt-6 shadow-lg">
Agendar <i class="fas fa-calendar-plus ml-2"></i>
</button>
<button id="back-step-3-btn" class="w-full btn-secondary font-bold py-3 rounded-xl mt-2
transition duration-300 transform hover:scale-105">
<i class="fas fa-arrow-left mr-2"></i> Voltar
</button>
</div>
</div>
<hr class="my-8 border-yellow-600 border-opacity-30">
<div class="text-center">
<h3 class="text-xl font-bold heading-font text-cream mb-4">Seus Agendamentos</h3>
<div id="client-appointments-list" class="space-y-4">
<!-- Agendamentos do cliente serão injetados aqui -->
</div>
</div>
</div>
<!-- View do Barbeiro -->
<div id="barber-view" class="hidden">
<h2 class="text-3xl font-extrabold heading-font text-transparent bg-clip-text bg-gradient-to-r
from-yellow-400 to-yellow-600 mb-6 text-center">Painel do Barbeiro</h2>
<div id="barber-login" class="space-y-4">
<input type="password" id="barber-password" placeholder="Senha de Acesso" class="w-full
p-3 input-dark rounded-xl focus:outline-none transition duration-200">
<button id="login-barber-btn" class="w-full bg-gray-800 text-cream font-bold py-3 rounded-xl
hover:bg-gray-700 transition duration-300 transform hover:scale-105 shadow-lg border
border-yellow-600 border-opacity-30">Entrar</button>
</div>
<div id="barber-appointments-panel" class="hidden">
<!-- Seção para gerenciar horários -->
<div class="dark-card p-6 rounded-2xl shadow-md mb-6">
<h3 class="text-xl font-bold heading-font text-cream mb-4">Gerenciar Agenda</h3>
<button id="open-add-modal-btn" class="w-full btn-primary font-bold py-3 rounded-xl
transition duration-300 transform hover:scale-105 mb-4 shadow-lg">
<i class="fas fa-plus mr-2"></i> Adicionar Agendamento
</button>
<div class="mt-8 pt-4 border-t border-yellow-600 border-opacity-30">
<h4 class="text-lg font-semibold text-warm-gray mb-2">Bloquear/Desbloquear Horário</h4>
<div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
<input type="date" id="block-date" class="w-full sm:w-1/2 p-3 input-dark rounded-xl">
<input type="time" id="block-time" class="w-full sm:w-1/2 p-3 input-dark rounded-xl">
</div>
<div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-4">
<button id="block-btn" class="w-full sm:w-1/2 bg-red-600 text-cream font-bold py-3
rounded-xl hover:bg-red-700 transition duration-300 transform hover:scale-105
shadow-md">
<i class="fas fa-lock mr-2"></i> Bloquear
</button>
<button id="unblock-btn" class="w-full sm:w-1/2 bg-amber-500 text-gray-900 font-bold py-3
rounded-xl hover:bg-amber-600 transition duration-300 transform hover:scale-105
shadow-md">
<i class="fas fa-unlock-alt mr-2"></i> Desbloquear
</button>
</div>
</div>
</div>
<div id="barber-appointments-list" class="space-y-4">
<!-- Agendamentos do Firebase serão injetados aqui -->
</div>
</div>
</div>
<!-- Painel de Análise -->
<div id="analytics-view" class="hidden">
  <h2 class="text-3xl font-extrabold heading-font text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-yellow-600 mb-6 text-center">Painel de Análise</h2>
  <div id="analytics-login" class="space-y-4">
    <input type="password" id="analytics-password" placeholder="Senha de Acesso" class="w-full p-3 input-dark rounded-xl focus:outline-none transition duration-200">
    <button id="login-analytics-btn" class="w-full bg-gray-800 text-cream font-bold py-3 rounded-xl hover:bg-gray-700 transition duration-300 transform hover:scale-105 shadow-lg border border-yellow-600 border-opacity-30">Entrar</button>
  </div>
  <div id="analytics-dashboard" class="hidden space-y-6">
    <!-- Filtros -->
    <div class="dark-card p-6 rounded-2xl shadow-md">
      <h3 class="text-xl font-bold heading-font text-cream mb-4">Filtros de Período</h3>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div>
          <label class="block text-warm-gray text-sm mb-2">Data Inicial</label>
          <input type="date" id="start-date" class="w-full p-3 input-dark rounded-xl">
        </div>
        <div>
          <label class="block text-warm-gray text-sm mb-2">Data Final</label>
          <input type="date" id="end-date" class="w-full p-3 input-dark rounded-xl">
        </div>
        <div>
          <label class="block text-warm-gray text-sm mb-2">Período</label>
          <select id="period-filter" class="w-full p-3 input-dark rounded-xl">
            <option value="all">Todo o período</option>
            <option value="today">Hoje</option>
            <option value="week">Esta semana</option>
            <option value="month">Este mês</option>
            <option value="custom">Personalizado</option>
          </select>
        </div>
        <div class="flex items-end">
          <button id="apply-filters-btn" class="w-full btn-primary font-bold py-3 rounded-xl transition duration-300 transform hover:scale-105 shadow-lg">
            <i class="fas fa-filter mr-2"></i> Aplicar
          </button>
        </div>
      </div>
    </div>
    <!-- Cards de Métricas Principais -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Total de Agendamentos -->
      <div class="glass-card p-6 rounded-2xl shadow-lg hover:shadow-xl transition duration-300">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-warm-gray text-sm font-medium">Total de Agendamentos</p>
            <p id="total-appointments" class="text-3xl font-bold text-cream">0</p>
          </div>
          <div class="bg-blue-500 bg-opacity-20 p-3 rounded-full">
            <i class="fas fa-calendar-alt text-2xl text-blue-400"></i>
          </div>
        </div>
      </div>
      <!-- Agendamentos Confirmados -->
      <div class="glass-card p-6 rounded-2xl shadow-lg hover:shadow-xl transition duration-300">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-warm-gray text-sm font-medium">Confirmados</p>
            <p id="confirmed-appointments" class="text-3xl font-bold text-green-400">0</p>
          </div>
          <div class="bg-green-500 bg-opacity-20 p-3 rounded-full">
            <i class="fas fa-check-circle text-2xl text-green-400"></i>
          </div>
        </div>
      </div>
      <!-- Agendamentos Pendentes -->
      <div class="glass-card p-6 rounded-2xl shadow-lg hover:shadow-xl transition duration-300">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-warm-gray text-sm font-medium">Pendentes</p>
            <p id="pending-appointments" class="text-3xl font-bold text-yellow-400">0</p>
          </div>
          <div class="bg-yellow-500 bg-opacity-20 p-3 rounded-full">
            <i class="fas fa-clock text-2xl text-yellow-400"></i>
          </div>
        </div>
      </div>
      <!-- Agendamentos Cancelados -->
      <div class="glass-card p-6 rounded-2xl shadow-lg hover:shadow-xl transition duration-300">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-warm-gray text-sm font-medium">Cancelados</p>
            <p id="canceled-appointments" class="text-3xl font-bold text-red-400">0</p>
          </div>
          <div class="bg-red-500 bg-opacity-20 p-3 rounded-full">
            <i class="fas fa-times-circle text-2xl text-red-400"></i>
          </div>
        </div>
      </div>
    </div>
    <!-- Cards de Faturamento -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Faturamento Realizado -->
      <div class="dark-card p-6 rounded-2xl shadow-md">
        <h3 class="text-xl font-bold heading-font text-cream mb-4 flex items-center">
          <i class="fas fa-money-bill-wave text-green-400 mr-3"></i>
          Faturamento Realizado
        </h3>
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-warm-gray">Serviços Realizados:</span>
            <span id="realized-revenue" class="text-2xl font-bold text-green-400">R$ 0,00</span>
          </div>
          <div class="text-sm text-warm-gray">
            <p>Baseado em agendamentos marcados como realizados</p>
          </div>
        </div>
      </div>
      <!-- Faturamento Estimado -->
      <div class="dark-card p-6 rounded-2xl shadow-md">
        <h3 class="text-xl font-bold heading-font text-cream mb-4 flex items-center">
          <i class="fas fa-chart-line text-yellow-400 mr-3"></i>
          Faturamento Estimado
        </h3>
        <div class="space-y-3">
          <div class="flex justify-between items-center">
            <span class="text-warm-gray">Potencial Total:</span>
            <span id="estimated-revenue" class="text-2xl font-bold text-yellow-400">R$ 0,00</span>
          </div>
          <div class="text-sm text-warm-gray">
            <p>Incluindo pendentes e confirmados</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
<!-- Firebase SDKs -->
<script type="module">
// Configuração Firebase simplificada
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
// Configuração Firebase (mantenha sua configuração original)
const firebaseConfig = {
  apiKey: "AIzaSyCgx6yZxS8w54CMTcX_dql7NNDJq5uhEn0",
  authDomain: "barbearia-agendamentos-9ad41.firebaseapp.com",
  projectId: "barbearia-agendamentos-9ad41",
  storageBucket: "barbearia-agendamentos-9ad41.firebasestorage.app",
  messagingSenderId: "612905646934",
  appId: "1:612905646934:web:d4715b8eb14bc7d821f4f7"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
// Constantes
const BARBER_PASSWORD = 'senha123';
const ANALYTICS_PASSWORD = 'analytics123';
const availableTimes = [
  '09:00', '09:30', '10:00', '10:30', '11:00', '11:30',
  '13:00', '13:30', '14:00', '14:30', '15:00', '15:30',
  '16:00', '16:30', '17:00', '17:30', '18:00', '18:30'
];
const servicePrices = {
  "Corte de Cabelo": 45.00,
  "Barba": 30.00,
  "Cabelo e Barba": 70.00,
  "Pigmentação": 60.00
};
// Variáveis globais
let appointmentData = {
  name: '',
  phone: '',
  service: null,
  date: null,
  time: null
};
let currentStep = 1;
let allAppointments = [];
let blockedSlots = [];
let analyticsAppointments = [];
let currentFilters = {
  startDate: null,
  endDate: null,
  period: 'all'
};
// --- Funções Utilitárias ---
function showModal(message) {
  const modal = document.getElementById('modal');
  document.getElementById('modal-message').textContent = message;
  modal.classList.remove('hidden');
}
function formatDate(dateString) {
  if (!dateString) return '';
  const [year, month, day] = dateString.split('-');
  return `${day}/${month}/${year}`;
}
function getNextSevenDays() {
  const dates = [];
  for (let i = 0; i < 7; i++) {
    const date = new Date();
    date.setDate(date.getDate() + i);
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = date.getFullYear();
    dates.push({
      full: `${year}-${month}-${day}`,
      day: day,
      weekday: date.toLocaleDateString('pt-BR', { weekday: 'short' }).split('.')[0]
    });
  }
  return dates;
}
// --- Navegação entre Views ---
function checkURLView() {
  const urlParams = new URLSearchParams(window.location.search);
  const view = urlParams.get('view');
  const clientView = document.getElementById('client-view');
  const barberView = document.getElementById('barber-view');
  const analyticsView = document.getElementById('analytics-view');
  // Esconder todas as views
  clientView.classList.add('hidden');
  barberView.classList.add('hidden');
  analyticsView.classList.add('hidden');
  if (view === 'barber') {
    barberView.classList.remove('hidden');
  } else if (view === 'analytics') {
    analyticsView.classList.remove('hidden');
  } else {
    clientView.classList.remove('hidden');
  }
}
// --- Renderização de Componentes ---
function renderDateButtons() {
  const container = document.getElementById('date-picker-container');
  container.innerHTML = '';
  const dates = getNextSevenDays();
  dates.forEach(d => {
    const button = document.createElement('button');
    button.className = `p-4 flex flex-col items-center justify-center date-button rounded-xl transition-colors`;
    button.innerHTML = `<span class="text-xs font-semibold uppercase text-warm-gray">${d.weekday}</span><span class="text-2xl font-bold text-cream">${d.day}</span>`;
    button.dataset.date = d.full;
    button.addEventListener('click', () => {
      document.querySelectorAll('#date-picker-container button').forEach(btn => btn.classList.remove('service-card-selected'));
      button.classList.add('service-card-selected');
      appointmentData.date = d.full;
      renderTimeButtons();
      updateStep3ButtonState();
    });
    container.appendChild(button);
  });
}
function renderTimeButtons() {
  const container = document.getElementById('time-picker-container');
  container.innerHTML = '';
  if (!appointmentData.date) return;
  const bookedTimes = allAppointments
    .filter(app => app.date === appointmentData.date && (app.status === 'pendente' || app.status === 'confirmado'))
    .map(app => app.time);
  const unavailableTimes = blockedSlots
    .filter(slot => slot.date === appointmentData.date)
    .map(slot => slot.time);
  const allUnavailable = new Set([...bookedTimes, ...unavailableTimes]);
  const availableTimesForDate = availableTimes.filter(time => !allUnavailable.has(time));
  if (availableTimesForDate.length === 0) {
    container.innerHTML = '<p class="text-center text-warm-gray col-span-full">Nenhum horário disponível.</p>';
  } else {
    availableTimesForDate.forEach(time => {
      const button = document.createElement('button');
      button.className = `py-3 px-2 time-button rounded-xl font-semibold transition-colors`;
      button.textContent = time;
      button.dataset.time = time;
      button.addEventListener('click', () => {
        document.querySelectorAll('#time-picker-container button').forEach(btn => btn.classList.remove('time-button-selected'));
        button.classList.add('time-button-selected');
        appointmentData.time = time;
        updateStep3ButtonState();
      });
      container.appendChild(button);
    });
  }
}
function updateStep3ButtonState() {
  const button = document.getElementById('next-step-3-btn');
  if (appointmentData.date && appointmentData.time) {
    button.disabled = false;
    button.className = 'w-full btn-primary font-bold py-3 rounded-xl mt-6 shadow-lg';
  } else {
    button.disabled = true;
    button.className = 'w-full btn-disabled font-bold py-3 rounded-xl mt-6 shadow-lg';
  }
}
function renderServiceCards() {
  const container = document.getElementById('service-options');
  container.innerHTML = '';
  const services = Object.keys(servicePrices);
  const serviceIcons = {
    "Corte de Cabelo": "fas fa-cut",
    "Barba": "fas fa-beard",
    "Cabelo e Barba": "fas fa-hair-alt",
    "Pigmentação": "fas fa-palette"
  };
  services.forEach(service => {
    const card = document.createElement('div');
    card.className = `service-card p-6 rounded-xl shadow-sm transition duration-200 cursor-pointer`;
    card.innerHTML = `
      <div class="text-center">
        <i class="${serviceIcons[service]} text-4xl text-yellow-400 mb-2"></i>
        <h4 class="text-lg font-bold text-cream">${service}</h4>
        <p class="text-sm text-warm-gray mt-1">R$ ${servicePrices[service].toFixed(2).replace('.', ',')}</p>
      </div>
    `;
    card.dataset.service = service;
    card.addEventListener('click', () => {
      document.querySelectorAll('.service-card').forEach(c => c.classList.remove('service-card-selected'));
      card.classList.add('service-card-selected');
      appointmentData.service = service;
      const nextBtn = document.getElementById('next-step-2-btn');
      nextBtn.disabled = false;
      nextBtn.className = 'w-full btn-primary font-bold py-3 rounded-xl mt-6 shadow-lg';
    });
    container.appendChild(card);
  });
}
// --- Navegação entre Etapas ---
function showStep(step) {
  document.querySelectorAll('.step').forEach(el => el.classList.add('hidden'));
  document.getElementById(`step-${step}`).classList.remove('hidden');
  currentStep = step;
  if (currentStep === 2) renderServiceCards();
  if (currentStep === 3) {
    renderDateButtons();
    renderTimeButtons();
  }
}
function resetClientUI() {
  appointmentData = { name: '', phone: '', service: null, date: null, time: null };
  document.getElementById('client-name').value = '';
  document.getElementById('client-phone').value = '';
  renderClientAppointments();
  showStep(1);
}
// --- Agendamentos do Cliente ---
function renderClientAppointments() {
  const list = document.getElementById('client-appointments-list');
  list.innerHTML = '';
  // Buscar agendamentos do cliente no Firebase baseado no telefone
  const clientPhone = document.getElementById('client-phone').value;
  if (!clientPhone) {
    list.innerHTML = '<p class="text-center text-warm-gray">Digite seu telefone para ver seus agendamentos.</p>';
    return;
  }
  const clientAppointments = allAppointments.filter(app => app.phone === clientPhone);
  if (clientAppointments.length === 0) {
    list.innerHTML = '<p class="text-center text-warm-gray">Nenhum agendamento encontrado.</p>';
    return;
  }
  clientAppointments.forEach(app => {
    const statusClass = {
      'pendente': 'status-pendente',
      'confirmado': 'status-confirmado',
      'cancelado': 'status-cancelado',
      'realizado': 'status-realizado'
    }[app.status] || 'bg-gray-100 text-gray-800';
    const formattedDate = formatDate(app.date);
    list.innerHTML += `
      <div class="dark-card p-5 rounded-xl shadow-sm hover:shadow-md transition duration-200">
        <div class="flex justify-between items-center mb-2">
          <span class="text-lg font-bold text-cream">${app.service}</span>
          <span class="status-badge ${statusClass}">${app.status}</span>
        </div>
        <div class="text-sm text-warm-gray space-y-1">
          <p><i class="fas fa-calendar-alt w-5 text-yellow-400"></i> <span class="font-semibold">${formattedDate}</span> às <span class="font-semibold">${app.time}</span></p>
          <p><i class="fas fa-dollar-sign w-5 text-yellow-400"></i> Preço: <span class="font-semibold">R$ ${servicePrices[app.service] ? servicePrices[app.service].toFixed(2).replace('.', ',') : 'N/A'}</span></p>
        </div>
      </div>
    `;
  });
}
// --- Funções Firebase ---
async function submitAppointment() {
  const newAppointment = {
    name: appointmentData.name,
    phone: appointmentData.phone,
    service: appointmentData.service,
    date: appointmentData.date,
    time: appointmentData.time,
    status: 'pendente',
    createdAt: new Date().toISOString()
  };
  try {
    await addDoc(collection(db, 'appointments'), newAppointment);
    showModal('Agendamento realizado com sucesso! Aguarde a confirmação do barbeiro.');
    resetClientUI();
  } catch (error) {
    console.error("Erro ao agendar:", error);
    showModal('Ocorreu um erro ao agendar. Verifique sua conexão e tente novamente.');
  }
}
function setupFirebaseListeners() {
  // Listener para agendamentos
  const appointmentsColRef = collection(db, 'appointments');
  onSnapshot(appointmentsColRef, (querySnapshot) => {
    allAppointments = [];
    querySnapshot.forEach((doc) => {
      allAppointments.push({ docId: doc.id, ...doc.data() });
    });
    renderBarberAppointments(allAppointments);
    if (currentStep === 3) renderTimeButtons();
  }, (error) => {
    console.error("Erro ao buscar agendamentos:", error);
    showModal('Erro ao carregar agendamentos. Verifique sua conexão.');
  });
  // Listener para slots bloqueados
  const blockedSlotsColRef = collection(db, 'blocked-slots');
  onSnapshot(blockedSlotsColRef, (querySnapshot) => {
    blockedSlots = [];
    querySnapshot.forEach((doc) => {
      blockedSlots.push({ docId: doc.id, ...doc.data() });
    });
    if (currentStep === 3) renderTimeButtons();
  }, (error) => {
    console.error("Erro ao buscar horários bloqueados:", error);
  });
}
function renderBarberAppointments(appointments) {
  const list = document.getElementById('barber-appointments-list');
  list.innerHTML = '';
  if (appointments.length === 0) {
    list.innerHTML = '<p class="text-center text-warm-gray">Nenhum agendamento encontrado.</p>';
    return;
  }
  appointments.sort((a, b) => {
    const dateA = new Date(`${a.date}T${a.time}`);
    const dateB = new Date(`${b.date}T${b.time}`);
    return dateA - dateB;
  });
  appointments.forEach(app => {
    const statusClass = {
      'pendente': 'status-pendente',
      'confirmado': 'status-confirmado',
      'cancelado': 'status-cancelado',
      'realizado': 'status-realizado'
    }[app.status] || 'bg-gray-100 text-gray-800';
    const formattedDate = formatDate(app.date);
    
    // Botões de ação baseados no status
    let actionButtons = '';
    if (app.status === 'pendente') {
      actionButtons = `
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-4">
          <button class="w-full bg-green-500 text-gray-900 font-bold py-2 rounded-lg hover:bg-green-400 transition duration-300 transform hover:scale-105"
            onclick="updateAppointmentStatus('${app.docId}', 'confirmado')">
            <i class="fas fa-check mr-2"></i> Confirmar
          </button>
          <button class="w-full bg-red-500 text-cream font-bold py-2 rounded-lg hover:bg-red-400 transition duration-300 transform hover:scale-105"
            onclick="updateAppointmentStatus('${app.docId}', 'cancelado')">
            <i class="fas fa-times mr-2"></i> Cancelar
          </button>
        </div>
      `;
    } else if (app.status === 'confirmado') {
      actionButtons = `
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-4">
          <button class="w-full bg-blue-500 text-cream font-bold py-2 rounded-lg hover:bg-blue-400 transition duration-300 transform hover:scale-105"
            onclick="updateAppointmentStatus('${app.docId}', 'realizado')">
            <i class="fas fa-check-double mr-2"></i> Realizado
          </button>
          <button class="w-full bg-red-500 text-cream font-bold py-2 rounded-lg hover:bg-red-400 transition duration-300 transform hover:scale-105"
            onclick="updateAppointmentStatus('${app.docId}', 'cancelado')">
            <i class="fas fa-times mr-2"></i> Cancelar
          </button>
        </div>
      `;
    }
    
    const actionLinks = `
      <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-4">
        <a href="${createWhatsAppLink(app.phone, app.name, app.date, app.time, app.service, app.status)}" target="_blank"
          class="w-full bg-green-500 text-gray-900 font-bold py-2 px-4 rounded-lg text-sm text-center hover:bg-green-400 transition duration-300 transform hover:scale-105 shadow-md">
          <i class="fab fa-whatsapp mr-2"></i> WhatsApp
        </a>
        <button class="w-full bg-gray-600 text-cream font-bold py-2 rounded-lg hover:bg-gray-500 transition duration-300 transform hover:scale-105 shadow-md"
          onclick="deleteAppointment('${app.docId}')">
          <i class="fas fa-trash-alt mr-2"></i> Excluir
        </button>
      </div>
    `;
    list.innerHTML += `
      <div class="dark-card p-6 rounded-2xl shadow-md hover:shadow-xl transition duration-200">
        <div class="flex items-center justify-between mb-2">
          <p class="text-xl font-bold text-cream">${app.name}</p>
          <span class="status-badge ${statusClass}">${app.status}</span>
        </div>
        <div class="text-sm text-warm-gray space-y-1">
          <p><i class="fas fa-cut w-5 text-yellow-400"></i> Serviço: <span class="font-semibold">${app.service}</span></p>
          <p><i class="fas fa-dollar-sign w-5 text-yellow-400"></i> Preço: <span class="font-semibold">R$ ${servicePrices[app.service] ? servicePrices[app.service].toFixed(2).replace('.', ',') : 'N/A'}</span></p>
          <p><i class="fas fa-calendar-alt w-5 text-yellow-400"></i> Data: <span class="font-semibold">${formattedDate}</span> às <span class="font-semibold">${app.time}</span></p>
          <p><i class="fas fa-phone-alt w-5 text-yellow-400"></i> Telefone: <span class="font-semibold">${app.phone}</span></p>
        </div>
        ${actionButtons}
        ${actionLinks}
      </div>
    `;
  });
}
// --- Event Listeners ---
document.getElementById('close-modal-btn').addEventListener('click', () => {
  document.getElementById('modal').classList.add('hidden');
});
// Navegação entre etapas do cliente
document.getElementById('next-step-1-btn').addEventListener('click', () => {
  const nameInput = document.getElementById('client-name');
  const phoneInput = document.getElementById('client-phone');
  if (nameInput.value.trim() && phoneInput.value.trim()) {
    appointmentData.name = nameInput.value.trim();
    appointmentData.phone = phoneInput.value.trim();
    showStep(2);
    renderClientAppointments(); // Atualizar lista ao mudar telefone
  } else {
    showModal('Por favor, preencha todos os campos corretamente.');
  }
});
document.getElementById('back-step-2-btn').addEventListener('click', () => showStep(1));
document.getElementById('next-step-2-btn').addEventListener('click', () => showStep(3));
document.getElementById('back-step-3-btn').addEventListener('click', () => showStep(2));
document.getElementById('next-step-3-btn').addEventListener('click', submitAppointment);
// Input do telefone - atualizar lista quando mudado
document.getElementById('client-phone').addEventListener('blur', renderClientAppointments);
// Login do barbeiro
document.getElementById('login-barber-btn').addEventListener('click', () => {
  const password = document.getElementById('barber-password').value;
  if (password === BARBER_PASSWORD) {
    document.getElementById('barber-login').classList.add('hidden');
    document.getElementById('barber-appointments-panel').classList.remove('hidden');
  } else {
    showModal('Senha incorreta!');
  }
});
// Modal para adicionar agendamento
document.getElementById('open-add-modal-btn').addEventListener('click', () => {
  document.getElementById('barber-add-modal').classList.remove('hidden');
});
document.getElementById('close-add-modal-btn').addEventListener('click', () => {
  document.getElementById('barber-add-modal').classList.add('hidden');
  document.getElementById('barber-add-form').reset();
});
document.getElementById('barber-add-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const name = document.getElementById('barber-client-name').value;
  const phone = document.getElementById('barber-client-phone').value;
  const service = document.getElementById('barber-service-select').value;
  const date = document.getElementById('barber-appointment-date').value;
  const time = document.getElementById('barber-appointment-time').value;
  const newAppointment = {
    name,
    phone,
    service,
    date,
    time,
    status: 'confirmado',
    createdAt: new Date().toISOString()
  };
  try {
    await addDoc(collection(db, 'appointments'), newAppointment);
    showModal('Agendamento adicionado com sucesso!');
    document.getElementById('barber-add-form').reset();
    document.getElementById('barber-add-modal').classList.add('hidden');
  } catch (error) {
    console.error("Erro ao adicionar agendamento:", error);
    showModal('Ocorreu um erro ao adicionar o agendamento. Verifique sua conexão.');
  }
});
// Bloquear/Desbloquear horários
document.getElementById('block-btn').addEventListener('click', async () => {
  const date = document.getElementById('block-date').value;
  const time = document.getElementById('block-time').value;
  if (!date || !time) {
    showModal('Selecione uma data e um horário para bloquear.');
    return;
  }
  try {
    await addDoc(collection(db, 'blocked-slots'), { date, time });
    showModal(`Horário ${time} na data ${formatDate(date)} foi bloqueado com sucesso!`);
    document.getElementById('block-date').value = '';
    document.getElementById('block-time').value = '';
  } catch (error) {
    console.error("Erro ao bloquear horário:", error);
    showModal('Ocorreu um erro ao bloquear o horário. Verifique sua conexão.');
  }
});
document.getElementById('unblock-btn').addEventListener('click', async () => {
  const date = document.getElementById('block-date').value;
  const time = document.getElementById('block-time').value;
  if (!date || !time) {
    showModal('Selecione uma data e um horário para desbloquear.');
    return;
  }
  try {
    const q = query(collection(db, 'blocked-slots'), where("date", "==", date), where("time", "==", time));
    const querySnapshot = await getDocs(q);
    if (!querySnapshot.empty) {
      querySnapshot.forEach(async (docRef) => { 
        await deleteDoc(docRef.ref); 
      });
      showModal(`Horário ${time} na data ${formatDate(date)} foi desbloqueado com sucesso!`);
      document.getElementById('block-date').value = '';
      document.getElementById('block-time').value = '';
    } else {
      showModal('Este horário não está bloqueado.');
    }
  } catch (error) {
    console.error("Erro ao desbloquear horário:", error);
    showModal('Ocorreu um erro ao desbloquear o horário. Verifique sua conexão.');
  }
});
// Login Analytics
document.getElementById('login-analytics-btn').addEventListener('click', () => {
  const password = document.getElementById('analytics-password').value;
  if (password === ANALYTICS_PASSWORD) {
    document.getElementById('analytics-login').classList.add('hidden');
    document.getElementById('analytics-dashboard').classList.remove('hidden');
    initializeAnalytics();
  } else {
    showModal('Senha incorreta!');
  }
});
// --- Funções Analytics ---
function initializeAnalytics() {
  setupAnalyticsListener();
  setDefaultDateRange();
  setupFilterEvents();
}
function setupAnalyticsListener() {
  const appointmentsColRef = collection(db, 'appointments');
  onSnapshot(appointmentsColRef, (querySnapshot) => {
    analyticsAppointments = [];
    querySnapshot.forEach((doc) => {
      analyticsAppointments.push({ docId: doc.id, ...doc.data() });
    });
    updateAnalytics();
  }, (error) => {
    console.error("Erro ao buscar agendamentos para análise:", error);
  });
}
function setDefaultDateRange() {
  const today = new Date();
  const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
  document.getElementById('end-date').value = today.toISOString().split('T')[0];
  document.getElementById('start-date').value = lastMonth.toISOString().split('T')[0];
}
function setupFilterEvents() {
  document.getElementById('period-filter').addEventListener('change', (e) => {
    const period = e.target.value;
    currentFilters.period = period;
    const today = new Date();
    let startDate, endDate;
    switch(period) {
      case 'today':
        startDate = endDate = today.toISOString().split('T')[0];
        break;
      case 'week':
        startDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 7).toISOString().split('T')[0];
        endDate = today.toISOString().split('T')[0];
        break;
      case 'month':
        startDate = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];
        endDate = today.toISOString().split('T')[0];
        break;
      case 'custom':
        return;
      case 'all':
      default:
        startDate = endDate = null;
        break;
    }
    if (startDate && endDate) {
      document.getElementById('start-date').value = startDate;
      document.getElementById('end-date').value = endDate;
    } else {
      document.getElementById('start-date').value = '';
      document.getElementById('end-date').value = '';
    }
    updateAnalytics();
  });
  document.getElementById('apply-filters-btn').addEventListener('click', () => {
    currentFilters.startDate = document.getElementById('start-date').value;
    currentFilters.endDate = document.getElementById('end-date').value;
    updateAnalytics();
  });
}
function filterAppointmentsByPeriod(appointments) {
  const startDate = document.getElementById('start-date').value;
  const endDate = document.getElementById('end-date').value;
  if (!startDate && !endDate) {
    return appointments;
  }
  return appointments.filter(app => {
    const appDate = app.date;
    if (startDate && appDate < startDate) return false;
    if (endDate && appDate > endDate) return false;
    return true;
  });
}
function updateAnalytics() {
  const filteredAppointments = filterAppointmentsByPeriod(analyticsAppointments);
  updateMainMetrics(filteredAppointments);
  updateRevenueMetrics(filteredAppointments);
}
function updateMainMetrics(appointments) {
  const total = appointments.length;
  const confirmed = appointments.filter(app => app.status === 'confirmado').length;
  const pending = appointments.filter(app => app.status === 'pendente').length;
  const canceled = appointments.filter(app => app.status === 'cancelado').length;
  const realized = appointments.filter(app => app.status === 'realizado').length;
  document.getElementById('total-appointments').textContent = total;
  document.getElementById('confirmed-appointments').textContent = confirmed;
  document.getElementById('pending-appointments').textContent = pending;
  document.getElementById('canceled-appointments').textContent = canceled;
}
function updateRevenueMetrics(appointments) {
  const realizedRevenue = appointments
    .filter(app => app.status === 'realizado')
    .reduce((sum, app) => sum + (servicePrices[app.service] || 0), 0);
  const estimatedRevenue = appointments
    .filter(app => app.status === 'confirmado' || app.status === 'pendente')
    .reduce((sum, app) => sum + (servicePrices[app.service] || 0), 0);
  document.getElementById('realized-revenue').textContent = 
    'R$ ' + realizedRevenue.toFixed(2).replace('.', ',');
  document.getElementById('estimated-revenue').textContent = 
    'R$ ' + estimatedRevenue.toFixed(2).replace('.', ',');
}
// --- Funções Globais para uso em onclick ---
window.updateAppointmentStatus = async (docId, newStatus) => {
  const appointmentRef = doc(db, 'appointments', docId);
  try {
    await updateDoc(appointmentRef, { status: newStatus });
    showModal("Status do agendamento atualizado com sucesso!");
  } catch (error) {
    console.error("Erro ao atualizar status:", error);
    showModal("Erro ao atualizar o status do agendamento. Verifique sua conexão.");
  }
};
window.deleteAppointment = async (docId) => {
  if (!confirm('Tem certeza que deseja excluir este agendamento?')) {
    return;
  }
  const appointmentRef = doc(db, 'appointments', docId);
  try {
    await deleteDoc(appointmentRef);
    showModal("Agendamento excluído com sucesso!");
  } catch (error) {
    console.error("Erro ao excluir agendamento:", error);
    showModal("Erro ao excluir o agendamento. Verifique sua conexão.");
  }
};
window.createWhatsAppLink = (phone, name, date, time, service, status) => {
  const formattedDate = formatDate(date);
  const statusMessage = {
    'pendente': `Olá ${name}, recebemos seu pedido de agendamento para ${service} no dia ${formattedDate} às ${time}. Assim que for confirmado, te avisaremos!`,
    'confirmado': `Olá ${name}, seu agendamento para ${service} no dia ${formattedDate} às ${time} foi CONFIRMADO! Estamos te esperando.`,
    'cancelado': `Olá ${name}, infelizmente precisamos CANCELAR seu agendamento para ${service} no dia ${formattedDate} às ${time}. Por favor, entre em contato para reagendar.`,
    'realizado': `Olá ${name}, seu agendamento para ${service} no dia ${formattedDate} às ${time} foi REALIZADO! Obrigado pela preferência!`
  }[status];
  const message = encodeURIComponent(statusMessage);
  return `https://wa.me/${phone}?text=${message}`;
};
// --- Inicialização ---
document.addEventListener('DOMContentLoaded', () => {
  console.log('DOM carregado, inicializando aplicação...');
  // Verificar view da URL
  checkURLView();
  // Configurar Firebase listeners
  setupFirebaseListeners();
  // Configurar listener para mudanças na URL
  window.addEventListener('popstate', checkURLView);
  console.log('Aplicação inicializada com sucesso!');
});
// Debug: Adicionar logs para verificar se o Firebase está conectando
console.log('Firebase inicializado:', app);
console.log('Firestore inicializado:', db);
</script>
</body>
</html>
